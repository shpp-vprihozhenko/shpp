<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Karel working page</title>
    <style>
        .field{
            float: left;
        }
        .dialog{
            float: right;
        }
    </style>
</head>
<body>
<div class="field">
    <canvas id="canvas" width="500" height="500"></canvas>
</div>
<div class="dialog">
    <h1>Enter Karel commands here:</h1>
    <form>
        <textarea id="task" cols="50" rows="30"></textarea>
        <input type="submit" value="Go, Karel!">
    </form>
</div>
</body>
<script>
    var stringField=[
        "1x x1x1x1x ",
        ">     1 1  ",
        "1x x2x1x1x "];

    map = new Field(stringField);

    onload=function(){
        b_canvas = document.getElementById("canvas");
        b_context = b_canvas.getContext("2d");

        numCols=map.getWidth();
        numRows=map.getHeight();
        cellSizeX=(b_canvas.width-15)/numCols;
        cellSizeY=(b_canvas.height-15)/numRows

        startX=5;
        startY=5;

        if(cellSizeY>cellSizeX)
            cellSizeY=cellSizeX;
        else
            cellSizeX=cellSizeY;

        drawMap();
    };
    function drawBlockedCell(x,y) {
        b_context.fillStyle="#000000";
        b_context.fillRect(startX+x*cellSizeX, startY+y*cellSizeY, cellSizeX, cellSizeY);
    }
    function drawClearCell(x,y) {
        b_context.fillStyle="#ffffff";
        b_context.fillRect(startX+x*cellSizeX, startY+y*cellSizeY, cellSizeX, cellSizeY);
    }
    function drawBeepersInCell(x, y, numBeepers) {
        b_context.fillStyle="#000000";
        b_context.arc(startX+x*cellSizeX, startY+y*cellSizeY, 20, 0, 2*Math.PI);
        b_context.fill();
//        b_context.stroke();
        b_context.beginPath();
    }
    function drawMap() {
        b_context.fillStyle="#000000";
        b_context.fillRect(0, 0, numCols*cellSizeX+10, numRows*cellSizeY+10);
        b_context.fillStyle="#ffffff";
        b_context.fillRect(5, 5, numCols*cellSizeX, numRows*cellSizeY);

        for(var i=0;i<numRows;i++){
            for(var j=0;j<numCols;j++){
                if(!map.isAvailible(j,i))
                    drawBlockedCell(j,i);
                else {
                    drawClearCell(j,i);
                    if(map.numBeepers(j,i)>0){
                        drawBeepersInCell(j,i);
                    }
                }
            }
        }
    }

    function Field(map) {
        this.map = map;
        this.isAvailible = function (x, y) {
            if (this.map[y].charAt(x) === 'x') {
                return false;
            } else {
                return true;
            }
        };
        this.numBeepers = function (x, y) {
            var beeperCount = parseInt(this.map[y].charAt(x), 10);
            return (isNaN(beeperCount)) ? 0 : beeperCount;
        };
        this.getKarelPosition = function () {
            for (var i = 0; i < this.map.length; i++) {
                for (var j = 0; j < this.map[i].length; j++) {
                    if (this.map[i][j] === 'v') {
                        return {x: j, y: i, direction: 0};
                    } else if (this.map[i][j] === '>') {
                        return {x: j, y: i, direction: 1};
                    } else if (this.map[i][j] === '^') {
                        return {x: j, y: i, direction: 2};
                    } else if (this.map[i][j] === '<') {
                        return {x: j, y: i, direction: 3};
                    }
                }
            }
        };
        this.getHeight = function () {
            return this.map.length;
        };
        this.getWidth = function () {
            return this.map[0].length;
        };
    }
</script>
</html>